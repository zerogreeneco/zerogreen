<!DOCTYPE html>
<th:block th:replace="~{basic/basicTemplate :: setContent(~{this::content})}" xmlns:th="http://www.w3.org/1999/xhtml"
          xmlns:sec="http://www.w3.org/1999/xhtml">
    <th:block th:fragment="content">
        <link th:href="@{/bootstrap/css/page/list.css}" rel="stylesheet"/>

        <script th:inline="javascript">
            $(function () {

                $(".main-like-btn").click(function (e) {

                    let likeBtn = $(this);
                    let boardId = likeBtn.closest("#list-wrapper").children(".list-board-id").val();

                    $.ajax({
                        url: "/zerogreen/community/like/" + boardId,
                        method: "post",
                        dataType: "json",
                        data: {
                            boardId: boardId
                        }
                    })
                        .done(function (data) {
                            if (data.count === 1) {
                                likeBtn.closest(".like-count").find(".like-img").attr("src", "/zerogreen/bootstrap/images/like/disLike.png")
                                likeBtn.closest(".like-count").children(".test-count").text(data.totalCount);
                            } else if (data.count === 0) {
                                likeBtn.closest(".like-count").find(".like-img").attr("src", "/zerogreen/bootstrap/images/like/like.png")
                                likeBtn.closest(".like-count").children(".test-count").text(data.totalCount);
                            }
                        });
                }); // like-btn end.

                $("#top-btn").click(function () {
                    $('html, body').animate({scrollTop: 0}, '400');
                });

                $("#search-btn").click(function () {

                    let type = $().val();
                    let content = $().val();

                    $.ajax({
                        url: ""
                    });

                });

                if (window.location.href == "http://localhost:8080/zerogreen/community") {
                    $(".category-list li:first").css('background', '#16a085');
                    $(".category-list a:first").css('color', '#fff');
                }
                if (window.location.href.indexOf("QNA") > -1) {
                    $(".category-list li").eq(1).css('background' , '#16a085');
                    $(".category-list a").eq(1).css('color', '#fff');
                }
                if (window.location.href.indexOf("VEGAN") > -1) {
                    $(".category-list li").eq(2).css('background' , '#16a085');
                    $(".category-list a").eq(2).css('color', '#fff');
                }
                if (window.location.href.indexOf("NEWS") > -1) {
                    $(".category-list li").eq(3).css('background' , '#16a085');
                    $(".category-list a").eq(3).css('color', '#fff');
                }
                if (window.location.href.indexOf("PLOGGING") > -1) {
                    $(".category-list li").eq(4).css('background' , '#16a085');
                    $(".category-list a").eq(4).css('color', '#fff');
                }
                if (window.location.href.indexOf("PLOVING") > -1) {
                    $(".category-list li").eq(5).css('background' , '#16a085');
                    $(".category-list a").eq(5).css('color', '#fff');
                }
            });
        </script>
        <style>
            .community-container {
                margin: 0 auto;
            }

            #content-left {
                width: 65%;
                display: inline-block;
                margin: 1em;
                float: left;
            }

            #content-right {
                width: 25%;
                display: inline-block;
                float: right;
            }

            @media screen and (max-width: 570px) {
                #content-left { width: 55% !important;}
                #content-right { width: 35% !important; float: none;}
                .thumbnail-box { float: none;}
            }
            @media screen and (max-width: 540px) {
                #content-left { width: 42% !important;}
                #content-right { width: auto !important; float: none;}
                .thumbnail-box { float: none;}
            }

            /* 카테고리 리스트 */
            ul.category-list {
                text-align: center;
                display: inline-block;
                margin-top: 12px;
            }

            ul.category-list li {
                display: inherit;
                font-family: 'Noto Sans KR', sans-serif;
                font-size: 16px;
                min-width: 50px;
                height: 20px;
                border: 2px solid #16a085;
                border-radius: 30px;
                padding: 5px 15px;
                cursor: pointer;
                text-align: center;
                margin-bottom: 3px;
            }

            ul.category-list li a {
                color: #16a085;
            }

            @media screen and (max-width: 710px){
                .category-list { margin-left: 20px; }
            }

            #list-wrapper {
                display: table;
                margin: 0 auto;
                border-bottom: 1px solid lightgray;
                height: 150px;
                margin-bottom: 10px;
            }

            .cm-content {
                display: table-cell;
                height: 150px;
            }

            /* 리스트 카테고리 */
            .main-list-category {
                margin: 15px 0 10px 0;
            }

            .cm-category {
                display: inline-block;
                font-family: 'Noto Sans KR', sans-serif;
                border-radius: 15px;
                padding: 8px 15px;
                background-color: #f1c40f;
                font-size: 0.9em;
                color: #FFF;
                text-decoration: none;
            }

            /* 리스트 텍스트 */
            .main-list-text {
                height: 60px;
                display: block;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .main-list-text p {
                display: block;
                height: 60px;
            }

            .main-list-text a {
                display: block;
                text-decoration: none;
                color: #000;
                height: 50px;
                width: 500px;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .main-like-btn {
                cursor: pointer;
            }

            /* 썸네일 */
            .thumbnail-box {
                height: 9em;
                width: 9em;
                border: 1px solid lightgray;
                margin: 20px;
                float: right;
            }

            /* 버튼 */
            #write-btn {
                position: fixed;
                bottom: 16%;
                right: 4%;
                width: 70px;
                height: 70px;
                border-radius: 50px;
                background: #f1c40f;
                padding: 5px;
            }

            #top-btn {
                position: fixed;
                bottom: 5%;
                right: 4%;
                width: 70px;
                height: 70px;
                border-radius: 50px;
                background: #f1c40f;
                padding: 5px;
            }

        </style>

        <!-- 버튼 -->
        <div>
            <button id="top-btn">
                <img th:src="@{/bootstrap/images/arrowup.png}" style="width: 35px;"/>
            </button>
        </div>
        <div sec:authorize="hasAnyRole('ROLE_USER','ROLE_ADMIN')">
            <button id="write-btn" type="button" th:onclick="|location.href='@{/community/write}'|">
                <img th:src="@{/bootstrap/images/edit.png}" style="width: 35px;"/>
            </button>
        </div>

        <!--검색-->
        <div class="form-area">
            <form th:method="get" th:action>
                <select class="dropdown" name="searchType">
                    <option th:each="searchType : ${T(zerogreen.eco.dto.search.SearchType).values()}"
                            th:value="${searchType}" th:text="${searchType.searchName}"></option>
                </select>
                <div class="search-bar">
                    <input id="search-input" name="keyword" th:value="${keyword}">
                    <img class="truncate_icon" th:src="@{/bootstrap/images/list/close.png}"/>
                </div>
                <button class="btn_search" type="submit">
                    <img class="search_icon" th:src="@{/bootstrap/images/list/search.png}">
                </button>
            </form>

            <!-- 카테고리 -->
            <div>
                <ul class="category-list">
                    <li>
                        <a th:href="@{/community}"> 전체 </a>
                    </li>
                    <li th:each="categories : ${category}" th:value="${categories.name()}">
                        <a th:text="${categories.categoryName}"
                           th:href="@{/community(category=${categories.name()}) }"></a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- 리스트 -->
        <div id="list-wrapper" th:each="community : ${communityList}">
            <input type="hidden" th:value="${community.id}" class="list-board-id">

            <div class="cm-content">
                <!--리스트 왼쪽-->
                <div id="content-left">
                    <div class="main-list-category">
                    <span>
                        <a th:href="@{/community(category=${community.category.name()}) }"
                           th:text="${community.category.categoryName}" class="cm-category">카테고리</a>
                    </span>
                    </div>
                    <div class="main-list-nickname" th:text="${community.nickname}">닉네임</div>
                    <div class="main-list-text">
                        <p><a th:href="@{/community/read/{boardId}(boardId = ${community.id})}"
                              th:text="${community.text}">글 내용</a></p>
                    </div>
                    <!-- 리스트 반응 수치 -->
                    <div>
                    <span class="main-list-views">
                        <img th:src="@{/bootstrap/images/list/visibility.png}"
                             width="17px" height="17px">[[${community.count}]]
                    </span>
                        <!-- 회원 좋아요 -->
                        <span sec:authorize="isAuthenticated()" id="like-wrapper">
            <span class="like-count">
                <span class="main-like-btn">
                    <img th:attr="src = @{/bootstrap/images/like/disLike.png}" class="like-img"
                         width="17px" height="17px"></span>
                <span class="test-count">[[${community.like}]]</span>
            </span>
                            <!--/*                <span class="like-count" th:if="${likeCount} == 1">
                                                <span id="like-btn"><img th:attr="src = @{/bootstrap/images/like/like.png}" class="like-img"
                                                                         width="17px" height="17px"></span>
                                                <span class="test-count">[[${community.like}]]</span>
                                            </span>*/-->
        </span>
                        <!-- 비회원 좋아요 -->
                        <span sec:authorize="isAnonymous()">
                        <img th:attr="src = @{/bootstrap/images/like/disLike.png}" class="like-img" width="17px"
                             height="17px"> [[${community.like}]]
                    </span>
                        <span>리뷰수 : [[${community.replyCount}]]</span>
                    </div>
                </div>

                <!--리스트 오른쪽-->
                <div id="content-right">
                    <!--썸네일-->
                    <div class="thumbnail-box"></div>
                </div>
            </div>
        </div>
    </th:block>
</th:block>
</html>