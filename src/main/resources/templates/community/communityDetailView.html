<!DOCTYPE html>
<th:block th:replace="~{basic/basicTemplate :: setContent(~{this::content})}" xmlns:th="http://www.w3.org/1999/xhtml">
    <th:block th:fragment="content">
        <link rel="stylesheet" th:href="@{/bootstrap/css/community/communityDeatailView.css}"/>
        <script th:inline="javascript" th:src="@{/bootstrap/js/community/community.js}"></script>
        <div th:object="${detailView}" class="cm-main-wrapper">
            <!-- 상세보기 제목 -->
            <input type="hidden" th:field="*{id}">
            <!-- 카테고리 -->
            <div th:field="*{category}">
                <a id="category" th:href="@{/community(category=${detailView.category.name()}) }"
                   th:text="*{category.categoryName}"></a>
            </div>
            <!-- 작성자 -->
            <span id="nickname" th:field="*{nickname}" th:text="*{nickname}"></span>
            <!-- 작성일자 -->
            <span th:field="*{modifiedDate}"
                  th:text="${#temporals.format(detailView.modifiedDate, 'yyyy-MM-dd HH:mm')}"></span>
            <!-- 조회수 -->
            <div></div>
            <span th:field="*{count}">
                <img th:src="@{/bootstrap/images/list/visibility.png}" width="17px" height="17px">[[*{count}]]
            </span>
            <!-- 회원 좋아요 -->
            <span sec:authorize="isAuthenticated()" id="like-wrapper">
                <span class="like-count" th:if="${likeCount} == 0">
                    <span id="like-btn"><img th:attr="src = @{/bootstrap/images/like/disLike.png}"
                                             class="like-img"></span>
                    <span class="test-count">[[*{like}]]</span>
                </span>
                <span class="like-count" th:if="${likeCount} == 1">
                    <span id="like-btn"><img th:attr="src = @{/bootstrap/images/like/like.png}" class="like-img"></span>
                    <span class="test-count">[[*{like}]]</span>
                </span>
            </span>
            <!-- 비회원 좋아요 -->
            <span sec:authorize="isAnonymous()">
                <span>
                    <img th:attr="src = @{/bootstrap/images/like/disLike.png}" class="like-img"> [[*{like}]]
                </span>
            </span>
        <div style="float: right">
            <a th:href="@{'/community/' + ${detailView.id} + '/modify'}">수정</a>
            <a id="delete-board">삭제</a>
        </div>
        </div>
        <!-- 상세보기 내용 -->
        <hr/>
        <div th:object="${detailView}" class="cm-main-wrapper">
            <div th:field="*{text}" th:text="*{text}"></div>
        </div>
        <!-- 이미지 -->
        <div th:each="imageFile : ${images}" class="image-wrapper">
            <img th:src="@{/community/images/{imageFile}(imageFile=*{imageFile.storeFileName})}"
                 th:value="${imageFile.uploadFileName}"
                 width="700px" height="auto">
        </div>
        <hr/>
        <!-- 상세보기 리뷰 작성 -->
        <div id="cm-review-wrapper" class="cm-main-wrapper">
            <div class="review-send" sec:authorize="isAuthenticated()">
                <form th:object="${reply}" method="post">
                    <input type="hidden" th:field="*{replyId}">
                    <p id="cm-input-name">[[${session.loginUserNickname}]]<span id="text-count" class="cm-text-count">0 / 100</span></p>
                    <textarea th:field="*{text}" class="review-text" placeholder="댓글을 남겨주세요."></textarea>
                    <a type="button" id="review-send-btn">리뷰 작성</a>
                </form>
            </div>
            <!-- 리뷰 출력-->
            <div id="review-table" class="cm-main-wrapper">
                <div th:each="replyList : ${replyList}">
                    <div class="comment-wrapper">
                        <input type="hidden" th:value="${replyList.replyId}" class="replyId">
                        <span th:text="${replyList.nickname}"></span>
                        <span style="font-size: 0.8em; padding-left: 10px;"
                              th:text="${#temporals.format(replyList.createdTime, 'yyyy-MM-dd HH:mm')}"></span>
                        <div>
                            <span class='cm-text-count' style="display: none;">0 / 100</span>
                        </div>
                        <p class="rp-text" th:text="${replyList.text}"></p>
                        <a type="button" class="modify-test-btn" style="display: none;"
                           onclick="modifyReply(this)">수정!
                        </a>

                        <a class="nested-reply-btn" onclick="nestedReplyInput(this)">답글</a>
                        <a th:if="${replyList.username} == ${session.loginUser}" th:onclick="'javascript:deleteReply(' + ${replyList.replyId} + ');'">삭제</a>
                        <a th:if="${replyList.username} == ${session.loginUser}" class="rp-modify-btn" onclick="replaceTag(this)">수정</a>
                        <div></div>
                        <div class="nested-reply-wrapper" style="display: none;">
                            <div><span class="cm-text-count">0 / 100</span></div>
                            <textarea class="nested-reply-input" onkeyup="limitTextInput(this)"></textarea>
                            <a onclick="nestedReplySend(this)">답글 달기</a>
                            <a>취소</a>
                        </div>
                        <hr/>
                        <div class="nested-list" th:each="nestedList : ${replyList.nestedReplyList}">
                            <input type="hidden" th:value="${nestedList.replyId}" class="replyId">
                            <span th:text="${nestedList.nickname}"></span>
                            <span style="font-size: 0.8em; padding-left: 10px;"
                                  th:text="${#temporals.format(nestedList.createdTime, 'yyyy-MM-dd HH:mm')}"></span>
                            <p class="rp-text" th:text="${nestedList.text}"></p>
                            <a type="button" class="modify-test-btn" style="display: none;"
                               onclick="modifyReply(this)">수정!
                            </a>
                            <a th:if="${nestedList.username} == ${session.loginUser}" th:onclick="'javascript:deleteReply(' + ${nestedList.replyId} + ');'">삭제</a>
                            <a th:if="${nestedList.username} == ${session.loginUser}" class="rp-modify-btn" onclick="replaceTag(this)">수정</a>
                            <hr/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</th:block>
</html>