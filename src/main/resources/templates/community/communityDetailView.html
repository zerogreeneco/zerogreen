<!DOCTYPE html>
<th:block th:replace="~{basic/basicTemplate :: setContent(~{this::content})}" xmlns:th="http://www.w3.org/1999/xhtml">
    <th:block th:fragment="content">
        <link rel="stylesheet" th:href="@{/bootstrap/css/community/communityDetailView.css}"/>
        <link rel="stylesheet" th:href="@{/bootstrap/css/community/communityList.css}"/>

        <script th:inline="javascript" th:src="@{/bootstrap/js/community/community.js}"></script>

        <div th:object="${detailView}" class="cm-main-wrapper">
            <input type="hidden" th:field="*{id}">
            <input type="hidden" th:field="*{memberId}" id="userId">

            <!-- 카테고리 -->
            <div th:field="*{category}">
                <a class="cm-category" th:href="@{/community(category=${detailView.category.name()}) }"
                   th:text="*{category.categoryName}"></a>
            </div>

            <!-- 작성자 프로필 -->
            <img id="writer-profile" th:src="@{'/bootstrap/images/profile/' +${detailView.vegetarianGrade}+'.png'}">
            <div id="writer-info">
                <!-- 작성자 닉네임 -->
                <span id="nickname" th:field="*{nickname}" th:text="*{nickname}"></span><br>
                <!-- 작성일자 -->
                <span id="date" th:field="*{modifiedDate}"
                      th:text="${#temporals.format(detailView.modifiedDate, 'yyyy-MM-dd HH:mm')}"></span>
            </div>

            <div class="right-side">
                <!-- 채팅 수정 삭제 -->
                <div style="margin-bottom: 3px;">
                    <a class="noto-font update-btn" th:href="@{/chatting/{boardId}(boardId = *{memberId})}" onclick="registration()" th:if="*{memberId} != ${session.memberId}">채팅하기</a>
                    <a class="noto-font update-btn" th:href="@{'/community/' + ${detailView.id} + '/modify'}" th:if="*{memberId} == ${session.memberId}">수정</a>
                    <a class="noto-font update-btn" id="delete-board" th:if="*{memberId} == ${session.memberId}">삭제</a>
                </div>
                <!--게시물 반응 수치-->
                <div>
                    <!-- 조회수 -->
                    <span class="reaction-icon" th:field="*{count}">
                        <img th:src="@{/bootstrap/images/list/visibility.png}" style="width: 16px; height: 15px; vertical-align: middle;">
                        [[*{count}]]
                    </span>
                    <!-- 회원 좋아요 -->
                    <span sec:authorize="isAuthenticated()" id="like-wrapper">
                        <span class="like-count reaction-icon" th:if="${likeCount} == 0">
                            <span id="like-btn"><img th:attr="src = @{/bootstrap/images/like/disLike.png}"
                                                     class="like-img"></span>
                            <span class="test-count">[[*{like}]]</span>
                        </span>
                        <span class="like-count reaction-icon" th:if="${likeCount} == 1">
                            <span id="like-btn"><img th:attr="src = @{/bootstrap/images/like/like.png}" class="like-img"></span>
                            <span class="test-count">[[*{like}]]</span>
                        </span>
                    </span>
                    <!-- 비회원 좋아요 -->
                    <span sec:authorize="isAnonymous()">
                    <span class="reaction-icon">
                        <img th:attr="src = @{/bootstrap/images/like/disLike.png}" class="like-img">
                        [[*{like}]]
                    </span>
        </span>
                </div>
            </div>
         </div>

        <!-- 상세보기 내용 -->
        <hr>
        <div th:object="${detailView}" class="cm-main-wrapper" style="padding: 10px;">
            <span th:field="*{text}" th:text="*{text}" style="line-height: 200%;"></span>
        </div>
        <!-- 이미지 -->
        <div th:each="imageFile : ${images}" class="image-wrapper">
            <img th:src="@{/community/images/{imageFile}(imageFile=*{imageFile.storeFileName})}"
                 th:value="${imageFile.uploadFileName}"
                 width="700px" height="auto">
        </div>

        <!-- 상세보기 리뷰 작성 -->
        <div id="cm-review-wrapper" class="성cm-main-wrapper">
            <div class="review-send" sec:authorize="isAuthenticated()">
                <form th:object="${reply}" method="post">
                    <input type="hidden" th:field="*{replyId}">
                    <p id="cm-input-name">[[${session.loginUserNickname}]]<span id="text-count" class="cm-text-count">0 / 100</span>
                    </p>
                    <textarea th:field="*{text}" class="review-text" placeholder="댓글을 남겨주세요."></textarea>
                    <a class="noto-font" type="button" id="review-send-btn" style="font-size: 0.9em;">작성하기</a>
                </form>
            </div>
            <!-- 댓글 리스트 -->
            <div id="review-table" class="cm-main-wrapper">
                <div th:each="replyList : ${replyList}">
                    <div class="comment-wrapper">
                        <input type="hidden" th:value="${replyList.replyId}" class="replyId">
                        <span>
                            <img th:src="@{'/bootstrap/images/profile/' +${replyList.vegetarianGrade}+'.png'}"
                                 width="15px" height="15px">
                        </span>
                        <span th:text="${replyList.nickname}"></span>
                        <span style="font-size: 0.8em; float:right; color:#969696; margin-right: 4px;"
                              th:text="${#temporals.format(replyList.createdTime, 'yy-MM-dd HH:mm')}"></span>
                        <div id="text-count-wrapper">
                            <span class='cm-text-count' style="display: none;">0 / 100</span>
                        </div>
                        <p class="rp-text" th:text="${replyList.text}"></p>
                        <a type="button" class="modify-test-btn" style="display: none;"
                           onclick="modifyReply(this)">수정
                        </a>
                        <div>
                            <a class="nested-reply-btn" style="margin-right:4px;" onclick="nestedReplyInput(this)">답글</a>
                            <a th:if="${replyList.username} == ${session.loginUser}"
                               th:onclick="'javascript:deleteReply(' + ${replyList.replyId} + ');'">삭제</a>
                            <a th:if="${replyList.username} == ${session.loginUser}" class="rp-modify-btn"
                               onclick="replaceTag(this)">수정</a>
                        </div>
                        <div></div>
                        <div class="nested-reply-wrapper" style="display: none;">
                            <textarea class="nested-reply-input" onkeyup="limitTextInput(this)"></textarea>
                            <div style="float:right; width: 15%;">
                                <span class="cm-text-count" style="margin-bottom: 10px;">0 / 100</span>
                                <a onclick="nestedReplySend(this)">등록</a>
                                <a>취소</a>
                            </div>
                        </div>
                        <hr/>
                        <!-- 대댓글 리스트 -->
                        <div class="nested-list" th:each="nestedList : ${replyList.nestedReplyList}">
                            <input type="hidden" th:value="${nestedList.replyId}" class="replyId">
                            <span>
                            <img th:src="@{'/bootstrap/images/profile/' +${nestedList.vegetarianGrade}+'.png'}"
                                 width="15px" height="15px">
                            </span>
                            <span th:text="${nestedList.nickname}"></span>
                            <span style="font-size: 0.8em; padding-left: 10px;"
                                  th:text="${#temporals.format(nestedList.createdTime, 'yyyy-MM-dd HH:mm')}"></span>
                            <p class="rp-text" th:text="${nestedList.text}"></p>
                            <a type="button" class="modify-test-btn" style="display: none;"
                               onclick="modifyReply(this)">수정!
                            </a>
                            <div>
                                <a th:if="${nestedList.username} == ${session.loginUser}"
                                   th:onclick="'javascript:deleteReply(' + ${nestedList.replyId} + ');'">삭제</a>
                                <a th:if="${nestedList.username} == ${session.loginUser}" class="rp-modify-btn"
                                   onclick="replaceTag(this)">수정</a>
                            </div>
                            <hr/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script th:src="@{/bootstrap/js/chat/custom.js}"></script>
        <script th:src="@{/bootstrap/js/chat/chat.js}"></script>
    </th:block>
</th:block>
</html>