<!DOCTYPE html>
<th:block th:replace="~{basic/basicTemplate :: setContent(~{this::content})}" xmlns:th="http://www.w3.org/1999/xhtml">
    <th:block th:fragment="content">

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
                integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

        <section>
            <form method="post" th:action="@{/admin/approve}">
                <table>
                    <tr th:object="${stores}">
                        <th></th>
                        <th>아이디</th>
                        <th>상호명</th>
                        <th>가게 연락처</th>
                        <th>가게 주소</th>
                        <th>등록번호</th>
                        <th>파일이름</th>
                    </tr>
                    <tr th:each="store : ${result.dtoList}">
                        <td><input type="checkbox" class="form-check-input"
                                   th:value="${store.memberId}" name="memberId"></td>
                        <td th:text="${store.username}"></td>
                        <td th:text="${store.storeName}"></td>
                        <td th:text="${store.storePhoneNumber}"></td>
                        <td th:text="${store.storeAddress}"></td>
                        <td th:text="${store.storeRegNum}"></td>
                        <td th:if="${store.fileId}"><a th:href="|/zerogreen/admin/approvalStore/attach/${store.fileId}|"
                                                       th:text="${store.uploadFileName}"></a></td>
                    </tr>
                    <input type="hidden" id="hiddenValue">
                </table>
                <div><p th:text="${msg}"></p></div>
                <button type="submit" id="approval-btn">승인</button>
                <ul>
                    <li th:if="${result.prev}">
                        <a tabindex="-1" th:href="@{/admin/approvalStore(page=${result.start -1})}">
                            prev
                        </a>
                    </li>
                    <li th:each="page : ${result.pageList}">
                        <a th:href="@{/admin/approvalStore(page=${page})}">
                            [[${page}]]
                        </a>
                    </li>
                    <li th:if="${result.next}">
                        <a th:href="@{/admin/approvalStore(page=${result.end + 1})}">
                            next
                        </a>
                    </li>
                </ul>
            </form>
        </section>
        <script th:inline="javascript">
            $(function () {
                $("#approval-btn").click(function () {
                    let obj = $("[name=memberId]");
                    let memberArray = [];

                    $("input:checkbox[name=memberId]:checked").each(function () {
                        memberArray.push($(this).val());
                    });

                    let val = $("#hiddenValue").val(memberArray);
                    alert(memberArray);

                    $.ajax({
                        url: "/zerogreen/admin/approve",
                        type: "post",
                        data: {
                            memberId: memberArray
                        },
                        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                        dataType: "json",
                        success: function (result) {
                            if (result === "fail") {
                                alert("실패");
                            } else if (result === "success") {
                                alert("성공");
                            }
                        },
                    });
                });

            });

        </script>
    </th:block>
</th:block>