<!DOCTYPE html>
<th:block th:replace="~{basic/basicTemplate :: setContent(~{this::content})}">
    <th:block th:fragment="content">

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
                integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

        <style>
            table tr {
                border: solid black 1px;
            }

            input[type="checkbox"] {
                -webkit-appearance: none;
                position: relative;
                width: 16px;
                height: 16px;
                cursor: pointer;
                outline: none !important;
                border: 1px solid #eeeeee;
                border-radius: 2px;
                background: #fbfbfb;
            }

            input[type="checkbox"]::before {
                content: "\2713";
                position: absolute;
                top: 50%;
                left: 50%;
                overflow: hidden;
                transform: scale(0) translate(-50%, -50%);
                line-height: 1;
            }

            input[type="checkbox"]:checked::before {
                border-radius: 2px;
                transform: scale(1) translate(-50%, -50%)
            }
        </style>

        <section>
            <form method="post" th:action="@{/admin/approve}">
                <table>
                    <tr th:object="${stores}">
                        <th></th>
                        <th>아이디</th>
                        <th>상호명</th>
                        <th>가게 연락처</th>
                        <th>가게 주소</th>
                        <th>등록번호</th>
                        <th>파일이름</th>
                    </tr>
                    <tr th:each="store : ${result.dtoList}">
                        <td><input type="checkbox" th:value="${store.memberId}" name="memberId"
                                   style="border: solid black 1px; width: 10px; height: 10px;"></td>
                        <td th:text="${store.username}"></td>
                        <td th:text="${store.storeName}"></td>
                        <td th:text="${store.storePhoneNumber}"></td>
                        <td th:text="${store.storeAddress}"></td>
                        <td th:text="${store.storeRegNum}"></td>
                        <td th:if="${store.fileId}"><a th:href="|/zerogreen/admin/approvalStore/attach/${store.fileId}|"
                                                       th:text="${store.uploadFileName}"></a></td>
                    </tr>
                    <input type="hidden" id="hiddenValue">
                </table>
                <div><p th:text="${msg}"></p></div>
                <button type="submit" id="approval-btn">승인</button>
                <ul>
                    <li th:if="${result.prev}">
                        <a tabindex="-1" th:href="@{/admin/approvalStore(page=${result.start -1})}">
                            prev
                        </a>
                    </li>
                    <li th:each="page : ${result.pageList}">
                        <a th:href="@{/admin/approvalStore(page=${page})}">
                            [[${page}]]
                        </a>
                    </li>
                    <li th:if="${result.next}">
                        <a th:href="@{/admin/approvalStore(page=${result.end + 1})}">
                            next
                        </a>
                    </li>
                </ul>
            </form>
        </section>
        <script th:inline="javascript">
            $(function () {
                $("#approval-btn").click(function () {
                    let obj = $("[name=memberId]");
                    let memberArray = [];

                    $("input:checkbox[name=memberId]:checked").each(function () {
                        memberArray.push($(this).val());
                    });

                    let val = $("#hiddenValue").val(memberArray);
                    alert(memberArray);

                    $.ajax({
                        url: "/zerogreen/admin/approve",
                        type: "post",
                        data: {
                            memberId: memberArray
                        },
                        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                        dataType: "json"
                    });
                });

            });

        </script>
    </th:block>
</th:block>