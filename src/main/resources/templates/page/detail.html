<!DOCTYPE html>
<th:block th:replace="~{basic/basicTemplate :: setContent(~{this::content})}" xmlns:th="http://www.w3.org/1999/xhtml"
          xmlns:sec="http://www.w3.org/1999/xhtml">
    <th:block th:fragment="content">
        <!--페이지 수정 부분 시작-->

        <!-- 페이지 css/ js 추가 -->
        <link th:href="@{/bootstrap/css/page/detail.css}" rel="stylesheet"/>
        <link id="contextPathHolder" th:data-contextPath="${#httpServletRequest.getContextPath()}"/>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
                integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

        <script th:src="@{/bootstrap/js/detail/detailReview.js}"></script>
        <script th:src="@{/bootstrap/js/detail/likes.js}"></script>

        <!-- 본문 시작 -->
        <div class="detail-content">

            <!-- 1열 -->
            <div class="detail-top temp1">
                <div class="top">가게 상세 이미지 들어갈 곳</div>
            </div>

            <!-- 2열 -->
            <div class="detail-sec temp2">
                <div class="store-name">
                    <span class="js-storeName">[[${getStore.storeName}]]</span>
                </div>
                <div class="sec-flex">
                    <!-- 좋아요 정보 -->
                    <div class="inline sec sec-left">
                        <div class="inline">
                            <!-- 회원 좋아요 -->
                            <div sec:authorize="isAuthenticated()" id="like-wrapper">

                                <div th:if="${cntLike} == 0">
                                    <img class="liking" th:attr="src = @{/bootstrap/images/like/disLike.png}">
                                    <!--                                <span class="countLikes">[[${cntLike}]]</span>-->
                                </div>

                                <div th:if="${cntLike} == 1">
                                    <img class="liking" th:attr="src = @{/bootstrap/images/like/like.png}">
                                    <!--                                <span class="countLikes">[[${cntLike}]]</span>-->
                                </div>
                            </div>
                            <!-- 비회원 좋아요 -->
                            <div sec:authorize="isAnonymous()">
                                <img th:attr="src = @{/bootstrap/images/like/disLike.png}" class="like-img"/>
                            </div>
                        </div>
                        <!--좋아요 수-->
                        <div class="inline">
                            <span class="like-cnt">[[${getStore.count}]]</span>
                        </div>
                    </div>

                    <!-- 리뷰정보 -->
                    <div class="inline sec sec-right">
                        <span>리뷰 </span>
                        <span class="review-cnt">[[${cnt2}]]</span>
                    </div>
                </div>

                <!-- 히든할것 -->
                <div style="display:none;">
                    <div sec:authorize="isAuthenticated()">
                        <div class="js-username" th:text="${member}"></div>
                    </div>
                </div>

            </div>

            <!-- 3열 -->
            <div class="detail-thr temp1">
                <!-- 3열 좌측 -->
                <div class="thr-thr inline">
                    <div class="thr thr-left">
                        <div th:object="${getStore}">
                            <span th:text="*{menuName}"></span><span th:text="*{menuPrice}"></span>
                        </div>
                    </div>
                </div>
                <!-- 3열 우측 -->
                <div class="thr-thr inline">

                    <div class="thr thr-right" th:object="${getStore}">
                        <input type="hidden" th:field="*{sno}">
                        <span>가게 소개 : </span><span th:text="*{storeInfo.storeDescription}"></span><br>
                        <span>전화 번호 : </span><span th:text="*{storeInfo.storePhoneNumber}"></span><br>
                        <span>영업 시간 : </span><span>[[*{storeInfo.openTime}]] - [[*{storeInfo.closeTime}]]</span><br>
                        <span>소셜 : </span><span>[[${getStore.storeInfo.socialAddress1}]]</span><br>
                        <span>소셜 : </span><span>[[${getStore.storeInfo.socialAddress2}]]</span><br>
                    </div>
                </div>
            </div>

            <!-- 4열 -->
            <div class="temp2 detail-map">
                <div id="map" style="width:900px;height:350px;"></div>
                <script type="text/javascript" th:src="@{/bootstrap/js/detail/detailMap.js}"></script>
                <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8b90a59d1c1c795a8266f3f47ebfd1ac&libraries=services"></script>
                <input hidden id="mapAddress" type="text" th:value="${getStore.storeAddress}">
            </div>

            <!-- 리뷰작성칸 -->
            <div class="rv temp1">

            <!-- 리뷰작성 textarea -->
            <form method="POST" th:object="${review}" enctype="multipart/form-data">
                <span class="js-storeId" style="display:none;">[[${getStore.sno}]]</span>

                <div class="inline rv-ta" >
                    <textarea th:field="*{reviewText}" name="reviewText" id="reviewText" class="reviewText"></textarea>
                </div>

                <div class="inline rv-btn">
                    <label class="img-input rvrv-btn inline" for="img-input">사진선택</label><br>
                    <input class="img-input" id="img-input" th:field="*{imageFiles}" name="reviewImages" type="file" multiple="multiple"/>
                    <label class="rvrv-btn inline" for="rv-btn">리뷰등록</label>
                    <button type="submit" id="rv-btn">리뷰등록</button>
<!--                    <span typeof="button" class="rvrv-btn inline" id="rv-btn">리뷰등록</span>-->
                </div>

                <!-- 리뷰작성 textarea -->
                <form method="POST" th:object="${review}" enctype="multipart/form-data">
                    <input type="hidden" th:field="*{sno}">

                    <div class="inline rv-ta">
                        <textarea th:field="*{reviewText}" name="reviewText" id="reviewText"
                                  class="reviewText"></textarea>
                    </div>

        <!-- 리뷰 이미지+텍스트 리스트 -->
        <div class="temp2">
            <!-- 리뷰리스트 -->
            <div id="reviewList">
                <!-- 리뷰 이미지 리스트 -->
                <div class="rv-images">
                    <div class="rv-img-list inline" th:each="imageList: ${reviewImageList}">
                        <img class="inline" th:src="@{/page/detail/images/{imageList}(imageList=*{imageList.reviewFileName})}"
                             th:value="${imageList.uploadFileName}"
                             width="120px" height="120px">
                    </div>
                </div>

                <div th:each="mReview : ${memberReview}">
                    <!-- 멤버리뷰 리스트 -->
                    <div class="reviewBox">
                        <span class="rno" style="display:none;" th:text="${mReview.rno}"></span>
                        <span class="rv-nickname">[[${mReview.nickname}]]</span>
                        <span>[[${mReview.rno}]]</span>
                        <span>[[${mReview.sno}]]</span>
                        <span>[[${mReview.id}]]</span>
                        <span>[[${mReview.storeName}]]</span>
                        <span class="rv-date inline">[[${#temporals.format(mReview.createdTime, 'yyyy-MM-dd HH:mm')}]]</span>
                        <br>

                        <div class="rv-img inline" th:each="mImage: ${mReview.imageList}">
                            <img class="inline" th:src="@{/page/detail/images/{mImage}(mImage=*{mImage.reviewFileName})}"
                                 th:value="${mImage.uploadFileName}"
                                 width="120px" height="120px">
                        </div>

                        <textarea class="rv-textarea" name="reviewText" readonly>[[${mReview.reviewText}]]</textarea><br>

                        <div class="btn-Box">
                            <span class="srv-toAdd inline mrv-btn"
                                  th:if="${rvMember == mReview.sno}">답글</span>
                            <span class="rv-modify inline mrv-btn" th:if="${rvMember} == ${mReview.id}">수정</span>
                            <span class="mrv-delete inline mrv-btn" th:if="${rvMember} == ${mReview.id}">삭제</span>
                        </div>

                        <!-- 스토어 리뷰 입력창 -->
                        <div class="srv-input" style="display:none;">
                            <textarea class="srv-input-textarea" name="storeReviewText" id="storeReviewText" ></textarea>
                            <div class="btn-Box">
                                <span class="srv-toAdd inline mrv-btn">답글</span>
                                <span class="mrv-modify inline mrv-btn">수정</span>
                                <span class="mrv-delete inline mrv-btn">삭제</span>
                            </div>


                       <!-- 스토어 리뷰 리스트 -->
                        <div class="sReview-Box" th:each="sReview: ${mReview.nestedReviewList}">
                            <div class="sReview-smallBox">
                                <span class="srno rno" th:text="${sReview.rno}" style="display:none;"></span>
                                <span class="srv-storeName">[[${sReview.storeName}]]</span>
                                <span class="rv-date inline">[[${#temporals.format(sReview.createdTime, 'yyyy-MM-dd HH:mm')}]]</span>
                                <br>
                                <textarea class="rv-textarea storeReviewText" name="storeReviewText" readonly>[[${sReview.reviewText}]]</textarea><br>
                                <div class="btn-Box">
                                    <span class="rv-modify inline mrv-btn" th:if="${rvMember} == ${sReview.id}">수정</span>
                                    <span class="srv-delete inline mrv-btn" th:if="${rvMember} == ${sReview.id}">삭제</span>
                                </div>
                            </div>

                        </div>
                        <!-- end reviewBox -->
                    </div>
                    <!-- end div - Each -->
                </div>
                <!-- end rv-list -->
            </div>
            <!-- end review images and review list -->

        </div>
        <!-- end of page-->

    </th:block>
</th:block>
